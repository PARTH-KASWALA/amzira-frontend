<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment | Amzira</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- Razorpay SDK -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    
    <style>
        /* Payment Page Styles */
        .payment-page {
            padding: 100px 0 60px;
            background: #fafafa;
            min-height: 100vh;
        }

        .payment-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Progress Steps (Same as checkout) */
        .checkout-progress {
            background: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 32px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--border-color);
            z-index: 0;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            position: relative;
            z-index: 1;
            background: #fafafa;
            padding: 0 12px;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--text-gray);
            transition: all 0.3s;
        }

        .progress-step.active .step-circle {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .progress-step.completed .step-circle {
            background: #10B981;
            border-color: #10B981;
            color: white;
        }

        .step-label {
            font-size: 13px;
            color: var(--text-gray);
            font-weight: 500;
            white-space: nowrap;
        }

        .progress-step.active .step-label {
            color: var(--primary-color);
        }

        /* Two Column Layout */
        .payment-grid {
            display: grid;
            grid-template-columns: 1fr 420px;
            gap: 32px;
            align-items: start;
        }

        /* Left Column - Payment Methods */
        .payment-main {
            background: white;
            padding: 32px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .section-title {
            font-size: 24px;
            font-family: var(--font-heading);
            color: var(--text-dark);
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title i {
            color: var(--primary-color);
        }

        /* Payment Method Tabs */
        .payment-tabs {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 32px;
        }

        .payment-tab {
            padding: 16px 12px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }

        .payment-tab:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .payment-tab.active {
            border-color: var(--primary-color);
            background: rgba(139, 21, 56, 0.05);
        }

        .payment-tab i {
            font-size: 28px;
            color: var(--text-gray);
            margin-bottom: 8px;
            display: block;
        }

        .payment-tab.active i {
            color: var(--primary-color);
        }

        .payment-tab span {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-dark);
            display: block;
        }

        /* Payment Forms */
        .payment-content {
            display: none;
        }

        .payment-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
            color: var(--text-dark);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 15px;
            transition: all 0.2s;
            font-family: var(--font-primary);
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(139, 21, 56, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 16px;
        }

        .card-logos {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .card-logos img {
            height: 32px;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .card-logos img:hover {
            opacity: 1;
        }

        .upi-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .upi-option {
            padding: 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .upi-option:hover {
            border-color: var(--primary-color);
        }

        .upi-option.selected {
            border-color: var(--primary-color);
            background: rgba(139, 21, 56, 0.05);
        }

        .upi-option img {
            height: 40px;
            margin-bottom: 8px;
        }

        .upi-option span {
            font-size: 13px;
            font-weight: 600;
            display: block;
        }

        .divider {
            text-align: center;
            margin: 24px 0;
            position: relative;
        }

        .divider span {
            background: white;
            padding: 0 16px;
            color: var(--text-gray);
            font-size: 14px;
            position: relative;
            z-index: 1;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--border-color);
        }

        .bank-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .bank-option {
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            font-weight: 500;
        }

        .bank-option:hover {
            border-color: var(--primary-color);
        }

        .bank-option.selected {
            border-color: var(--primary-color);
            background: rgba(139, 21, 56, 0.05);
        }

        .cod-info {
            background: #FEF3C7;
            border: 1px solid #FCD34D;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .cod-info i {
            color: #F59E0B;
            margin-right: 8px;
        }

        .cod-info p {
            font-size: 14px;
            color: #92400E;
            margin: 0;
        }

        /* Right Column - Order Summary */
        .payment-sidebar {
            position: sticky;
            top: 100px;
        }

        .order-summary {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 24px;
        }

        .summary-title {
            font-size: 20px;
            font-family: var(--font-heading);
            color: var(--text-dark);
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border-color);
        }

        .delivery-address {
            background: #fafafa;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .address-label {
            font-size: 13px;
            color: var(--text-gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .address-details {
            font-size: 14px;
            color: var(--text-dark);
            line-height: 1.6;
        }

        .price-breakdown {
            padding: 20px 0;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .price-label {
            color: var(--text-gray);
        }

        .price-value {
            font-weight: 600;
            color: var(--text-dark);
        }

        .price-value.discount {
            color: #10B981;
        }

        .price-row.total {
            padding-top: 16px;
            border-top: 2px solid var(--border-color);
            margin-top: 16px;
            font-size: 18px;
        }

        .price-row.total .price-label {
            color: var(--text-dark);
            font-weight: 600;
        }

        .price-row.total .price-value {
            color: var(--primary-color);
            font-size: 22px;
        }

        .btn-pay {
            width: 100%;
            padding: 18px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-pay:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 21, 56, 0.3);
        }

        .btn-pay:disabled {
            background: var(--text-light);
            cursor: not-allowed;
            transform: none;
        }

        .secure-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-top: 16px;
            font-size: 13px;
            color: var(--text-gray);
        }

        .secure-badge i {
            color: #10B981;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .payment-grid {
                grid-template-columns: 1fr;
            }

            .payment-sidebar {
                position: static;
            }

            .payment-tabs {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .payment-page {
                padding: 80px 0 40px;
            }

            .payment-main,
            .order-summary {
                padding: 20px;
            }

            .section-title {
                font-size: 20px;
            }

            .payment-tabs {
                grid-template-columns: 1fr;
            }

            .upi-options,
            .bank-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <!-- Include your existing header -->
    </header>

    <!-- Payment Page -->
    <main class="payment-page">
        <div class="payment-container">
            <!-- Progress Steps -->
            <div class="checkout-progress">
                <div class="progress-steps">
                    <div class="progress-step completed">
                        <div class="step-circle">
                            <i class="fas fa-check"></i>
                        </div>
                        <span class="step-label">Cart</span>
                    </div>
                    <div class="progress-step completed">
                        <div class="step-circle">
                            <i class="fas fa-check"></i>
                        </div>
                        <span class="step-label">Address</span>
                    </div>
                    <div class="progress-step active">
                        <div class="step-circle">3</div>
                        <span class="step-label">Payment</span>
                    </div>
                    <div class="progress-step">
                        <div class="step-circle">4</div>
                        <span class="step-label">Confirmation</span>
                    </div>
                </div>
            </div>

            <!-- Payment Grid -->
            <div class="payment-grid">
                <!-- Left - Payment Methods -->
                <div class="payment-main">
                    <h2 class="section-title">
                        <i class="fas fa-credit-card"></i>
                        Select Payment Method
                    </h2>

                    <!-- Payment Tabs -->
                    <div class="payment-tabs">
                        <div class="payment-tab active" data-method="card">
                            <i class="fas fa-credit-card"></i>
                            <span>Card</span>
                        </div>
                        <div class="payment-tab" data-method="upi">
                            <i class="fas fa-mobile-alt"></i>
                            <span>UPI</span>
                        </div>
                        <div class="payment-tab" data-method="netbanking">
                            <i class="fas fa-university"></i>
                            <span>Net Banking</span>
                        </div>
                        <div class="payment-tab" data-method="cod">
                            <i class="fas fa-money-bill-wave"></i>
                            <span>Cash on Delivery</span>
                        </div>
                    </div>

                    <!-- Card Payment -->
                    <div class="payment-content active" id="cardPayment">
                        <form id="cardForm">
                            <div class="form-group">
                                <label>Card Number</label>
                                <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
                            </div>

                            <div class="form-group">
                                <label>Cardholder Name</label>
                                <input type="text" id="cardName" placeholder="Name on card">
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Expiry Date</label>
                                    <input type="text" id="cardExpiry" placeholder="MM/YY" maxlength="5">
                                </div>
                                <div class="form-group">
                                    <label>CVV</label>
                                    <input type="password" id="cardCVV" placeholder="123" maxlength="3">
                                </div>
                            </div>

                            <div class="card-logos">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/0/04/Visa.svg" alt="Visa">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" alt="Mastercard">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/f/fa/American_Express_logo_%282018%29.svg" alt="Amex">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/d/d6/Rupay-Logo.png" alt="RuPay">
                            </div>
                        </form>
                    </div>

                    <!-- UPI Payment -->
                    <div class="payment-content" id="upiPayment">
                        <div class="upi-options">
                            <div class="upi-option" data-upi="gpay">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/f/f2/Google_Pay_Logo.svg" alt="Google Pay">
                                <span>Google Pay</span>
                            </div>
                            <div class="upi-option" data-upi="phonepe">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/0/04/PhonePe_Logo.png" alt="PhonePe">
                                <span>PhonePe</span>
                            </div>
                            <div class="upi-option" data-upi="paytm">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/2/24/Paytm_Logo_%28standalone%29.svg" alt="Paytm">
                                <span>Paytm</span>
                            </div>
                        </div>

                        <div class="divider"><span>OR</span></div>

                        <form id="upiForm">
                            <div class="form-group">
                                <label>Enter UPI ID</label>
                                <input type="text" id="upiId" placeholder="yourname@upi">
                            </div>
                        </form>
                    </div>

                    <!-- Net Banking -->
                    <div class="payment-content" id="netbankingPayment">
                        <form id="netbankingForm">
                            <div class="form-group">
                                <label>Select Your Bank</label>
                                <select id="bankSelect">
                                    <option value="">Choose your bank</option>
                                    <option value="sbi">State Bank of India</option>
                                    <option value="hdfc">HDFC Bank</option>
                                    <option value="icici">ICICI Bank</option>
                                    <option value="axis">Axis Bank</option>
                                    <option value="kotak">Kotak Mahindra Bank</option>
                                    <option value="pnb">Punjab National Bank</option>
                                    <option value="bob">Bank of Baroda</option>
                                    <option value="other">Other Banks</option>
                                </select>
                            </div>

                            <p style="font-size: 14px; color: var(--text-gray); margin-top: 16px;">
                                <i class="fas fa-info-circle"></i>
                                You will be redirected to your bank's website to complete the payment securely.
                            </p>
                        </form>
                    </div>

                    <!-- Cash on Delivery -->
                    <div class="payment-content" id="codPayment">
                        <div class="cod-info">
                            <p>
                                <i class="fas fa-info-circle"></i>
                                <strong>Cash on Delivery:</strong> Pay when you receive your order. No advance payment required.
                            </p>
                        </div>

                        <p style="font-size: 14px; color: var(--text-gray); line-height: 1.6;">
                            Please keep exact change ready. Our delivery partner will collect the payment at the time of delivery. This option may not be available for all pincodes.
                        </p>
                    </div>
                </div>

                <!-- Right - Order Summary -->
                <div class="payment-sidebar">
                    <div class="order-summary">
                        <h3 class="summary-title">Order Summary</h3>

                        <!-- Delivery Address -->
                        <div class="delivery-address">
                            <div class="address-label">
                                <i class="fas fa-map-marker-alt"></i>
                                Delivering To
                            </div>
                            <div class="address-details" id="deliveryAddress">
                                <!-- Address will be loaded here -->
                            </div>
                        </div>

                        <!-- Price Breakdown -->
                        <div class="price-breakdown">
                            <div class="price-row">
                                <span class="price-label">Subtotal</span>
                                <span class="price-value" id="subtotal">‚Çπ0</span>
                            </div>
                            <div class="price-row">
                                <span class="price-label">Discount</span>
                                <span class="price-value discount" id="discount">- ‚Çπ0</span>
                            </div>
                            <div class="price-row">
                                <span class="price-label">Shipping</span>
                                <span class="price-value" id="shipping">‚Çπ0</span>
                            </div>
                            <div class="price-row">
                                <span class="price-label">Tax (GST 18%)</span>
                                <span class="price-value" id="tax">‚Çπ0</span>
                            </div>
                            <div class="price-row total">
                                <span class="price-label">Total Amount</span>
                                <span class="price-value" id="total">‚Çπ0</span>
                            </div>
                        </div>

                        <!-- Pay Button -->
                        <button class="btn-pay" id="payButton">
                            <i class="fas fa-lock"></i>
                            Pay Securely
                        </button>

                        <div class="secure-badge">
                            <i class="fas fa-shield-alt"></i>
                            100% Secure Payment
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
 <!-- FEATURES STRIP (Top of Footer) -->
<section class="features-strip">
  <div class="features-container">
        <div class="feature-item">
            <img src="images/icons/MADE IN INDIA.svg" class="feature-icon feature-icon-svg" alt="Made in India">
            <h4>MADE IN INDIA</h4>
        </div>
        <div class="feature-item">
            <img src="images/icons/ASSURED QUALITY.svg" class="feature-icon feature-icon-svg" alt="Assured Quality">
            <h4>ASSURED QUALITY</h4>
        </div>
        <div class="feature-item">
            <img src="images/icons/SECURE PAYMENTS.svg" class="feature-icon feature-icon-svg" alt="Secure Payments">
            <h4>SECURE PAYMENTS</h4>
        </div>
        <div class="feature-item">
            <img src="images/icons/EMPOWERING WEAVERS.svg" class="feature-icon feature-icon-svg" alt="Empowering Weavers">
            <h4>EMPOWERING WEAVERS</h4>
        </div>
        <div class="feature-item">
            <img src="images/icons/24x7 Customer Support.svg" class="feature-icon feature-icon-svg" alt="24x7 Customer Support">
            <h4>24√ó7 CUSTOMER SUPPORT</h4>
        </div>
  </div>
</section>

<!-- MAIN FOOTER -->
<footer class="main-footer">
  <div class="footer-content">
    
    <!-- Brand Section -->
    <div class="footer-column brand-column footer-brand">
      <div class="brand-row">
        <img src="images/logo/Amzira_logo.png" class="brand-logo" alt="Amzira logo">
        <img src="images/logo/Amzira_name.png" class="brand-name" alt="Amzira">
      </div>
      <p class="brand-tagline">Premium Indian Ethnic Wear</p>
    </div>

    <!-- Categories -->
    <div class="footer-column">
      <h3 class="footer-heading">CATEGORIES</h3>
      <ul class="footer-links">
        <li><a href="#">Kurta Pajama</a></li>
        <li><a href="#">Kurta Jacket Sets</a></li>
        <li><a href="#">Only Kurtas</a></li>
        <li><a href="#">Nehru Jackets</a></li>
        <li><a href="#">Indo Western</a></li>
        <li><a href="#">Sherwani</a></li>
        <li><a href="#">Lehenga</a></li>
        <li><a href="#">Saree</a></li>
        <li><a href="#">Kidswear</a></li>
        <li><a href="#">Accessories</a></li>
      </ul>
    </div>

    <!-- Support -->
    <div class="footer-column">
      <h3 class="footer-heading">SUPPORT</h3>
      <ul class="footer-links">
        <li><a href="#">Track Order</a></li>
        <li><a href="#">Contact Us</a></li>
        <li><a href="#">My Account</a></li>
      </ul>
    </div>

    <!-- Quick Links -->
    <div class="footer-column">
      <h3 class="footer-heading">QUICK LINKS</h3>
      <ul class="footer-links">
        <li><a href="#">About Us</a></li>
        <li><a href="#">Brand Story</a></li>
        <li><a href="#">Blogs</a></li>
        <li><a href="#">Careers</a></li>
        <li><a href="#">Book a Video Call</a></li>
        <li><a href="#">Store Locator</a></li>
      </ul>
    </div>

    <!-- Our Policies -->
    <div class="footer-column">
      <h3 class="footer-heading">OUR POLICIES</h3>
      <ul class="footer-links">
        <li><a href="#">FAQs</a></li>
        <li><a href="#">Shipping Details</a></li>
        <li><a href="#">Return, Exchange and Refund Policy</a></li>
        <li><a href="#">Terms of Use</a></li>
        <li><a href="#">Privacy Policy</a></li>
        <li><a href="#">Cookie Policy</a></li>
      </ul>
    </div>

    <!-- Contact -->
    <div class="footer-column">
      <h3 class="footer-heading">CONTACT</h3>
      <ul class="footer-links contact-links">
        <li><a href="mailto:care@amzira.com">care@amzira.com</a></li>
        <li><a href="tel:+911800120000500">Call us at: 1800-120-000-500 (India)</a></li>
        <li><a href="tel:+919674373838">+91 9674373838 (International)</a></li>
        <li class="timing">10 am - 7 pm, Monday ‚Äì Saturday</li>
      </ul>
      
      <!-- Social Media -->
      <div class="social-icons">
        <h4 class="social-heading">KEEP IN TOUCH</h4>
        <div class="social-links">
          <a href="#" aria-label="Facebook">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
            </svg>
          </a>
          <a href="#" aria-label="Twitter">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
            </svg>
          </a>
          <a href="#" aria-label="Instagram">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z"/>
            </svg>
          </a>
          <a href="#" aria-label="LinkedIn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
          </a>
          <a href="#" aria-label="YouTube">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
            </svg>
          </a>
          <a href="#" aria-label="Pinterest">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.401.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607 0 11.985-5.365 11.985-11.987C23.97 5.39 18.592.026 11.985.026L12.017 0z"/>
            </svg>
          </a>
        </div>
      </div>
    </div>

  </div>

  
<footer class="footer-bar">
  <div class="footer-left">
    <span class="brand">amzira</span>
    <span class="country">üåê India</span>
  </div>

  <div class="footer-center">
    ¬© 2025 Amzira Ltd. All rights reserved.
  </div>

  <div class="footer-right">
    <span class="secure-text">100% Secure Payments</span>
    <div class="payments">
      <img src="payment-visa.png" alt="Visa">
      <img src="mastercard.png" alt="Mastercard">
      <img src="rupay.png" alt="RuPay">
      <img src="upi.png" alt="UPI">
    </div>
  </div>
</footer>




    <!-- Scripts -->
<script src="js/api.js"></script>
<script src="js/auth.js"></script>
<script src="js/address.js"></script>
<script src="js/orders.js"></script>

<script>
    if (!Auth.requireLogin('payment.html')) {
        // Redirect handled by Auth manager.
    }

    const PENDING_ORDER_KEY = 'pendingPaymentOrder';
    const CART_RESTORE_NOTICE_KEY = 'cartRestoreNotice';
    const CART_FORCE_RELOAD_KEY = 'cartForceReload';
    const RATE_LIMIT_LOCK_MS = 10000;
    let selectedPaymentMethod = 'card';
    let checkoutContext = { deliveryAddress: null, cart: null, pendingOrder: null };
    let rateLimitedUntil = 0;
    let pendingStatusPollId = null;
    let paymentExpiryTimer = null;

    function esc(value) {
        if (window.AMZIRA?.utils?.escapeHtml) return window.AMZIRA.utils.escapeHtml(value);
        const div = document.createElement('div');
        div.textContent = value == null ? '' : String(value);
        return div.innerHTML;
    }

    function showError(message) {
        if (window.errorHandler?.showError) {
            window.errorHandler.showError(message);
            return;
        }
        alert(message);
    }

    function showSuccess(message) {
        if (window.errorHandler?.showSuccess) {
            window.errorHandler.showSuccess(message);
            return;
        }
        alert(message);
    }

    function showWarning(message) {
        if (window.errorHandler?.showWarning) {
            window.errorHandler.showWarning(message);
            return;
        }
        alert(message);
    }

    function apiMessage(error, fallback) {
        if (window.AMZIRA?.utils?.getApiErrorMessage) {
            return window.AMZIRA.utils.getApiErrorMessage(error, fallback);
        }
        return error?.message || fallback;
    }

    function normalizeCartItems(cartData) {
        return cartData?.items || cartData?.cart_items || [];
    }

    /**
     * Redirect back to cart with a restore/failure notice.
     * @param {string} message
     */
    function redirectToCartWithRestore(message) {
        sessionStorage.setItem(CART_RESTORE_NOTICE_KEY, message);
        sessionStorage.setItem(CART_FORCE_RELOAD_KEY, '1');
        window.location.href = 'cart.html';
    }

    function getPaymentExpiryBanner() {
        let banner = document.getElementById('paymentExpiryBanner');
        if (banner) return banner;

        banner = document.createElement('div');
        banner.id = 'paymentExpiryBanner';
        banner.style.cssText = 'display:none;margin-bottom:16px;padding:12px 14px;border:1px solid #f59e0b;background:#fffbeb;color:#92400e;border-radius:8px;font-weight:600;';
        const paymentMain = document.querySelector('.payment-main');
        if (paymentMain) {
            paymentMain.insertBefore(banner, paymentMain.firstChild.nextSibling);
        }
        return banner;
    }

    /**
     * Format remaining milliseconds into MM:SS.
     * @param {number} msLeft
     * @returns {string}
     */
    function formatCountdown(msLeft) {
        const totalSeconds = Math.max(0, Math.ceil(msLeft / 1000));
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    function lockPayButton(ms = RATE_LIMIT_LOCK_MS, message = 'Too many requests. Please slow down.') {
        const payButton = document.getElementById('payButton');
        if (!payButton) return;
        rateLimitedUntil = Date.now() + ms;
        payButton.disabled = true;
        payButton.innerHTML = '<i class="fas fa-hourglass-half"></i> Please wait...';
        showWarning(message);

        window.setTimeout(() => {
            if (Date.now() < rateLimitedUntil) return;
            payButton.disabled = false;
            payButton.innerHTML = '<i class="fas fa-lock"></i> Pay Securely';
        }, ms);
    }

    function setPendingOrder(orderLike) {
        if (!orderLike) {
            sessionStorage.removeItem(PENDING_ORDER_KEY);
            checkoutContext.pendingOrder = null;
            return;
        }

        const pending = {
            id: orderLike.id || orderLike.order_id || orderLike.orderId || null,
            ref: orderLike.order_number || orderLike.order_no || orderLike.number || orderLike.id || null,
            expiresAt: orderLike.expires_at || orderLike.expiresAt || null
        };

        checkoutContext.pendingOrder = pending;
        sessionStorage.setItem(PENDING_ORDER_KEY, JSON.stringify(pending));
    }

    function getPendingOrder() {
        if (checkoutContext.pendingOrder?.id || checkoutContext.pendingOrder?.ref) {
            return checkoutContext.pendingOrder;
        }

        const raw = sessionStorage.getItem(PENDING_ORDER_KEY);
        if (!raw) return null;
        try {
            const parsed = JSON.parse(raw);
            checkoutContext.pendingOrder = parsed;
            return parsed;
        } catch (_) {
            sessionStorage.removeItem(PENDING_ORDER_KEY);
            return null;
        }
    }

    function classifyOrderState(orderDetail) {
        const orderStatus = String(orderDetail?.status || orderDetail?.order_status || '').toLowerCase();
        const paymentStatus = String(orderDetail?.payment_status || '').toLowerCase();

        if (['cancelled', 'canceled'].includes(orderStatus)) return 'cancelled';
        if (['expired'].includes(orderStatus)) return 'expired';
        if (['paid', 'captured', 'success'].includes(paymentStatus)) return 'paid';
        if (['failed'].includes(paymentStatus)) return 'payment_failed';
        return 'pending_payment';
    }

    async function getOrderDetailForPending() {
        const pending = getPendingOrder();
        if (!pending) return null;
        const orderRef = pending.ref || pending.id;
        if (!orderRef) return null;
        return window.AMZIRA.orders.getOrderDetail(orderRef);
    }

    async function refreshPendingOrderStatus(showUserMessage = false) {
        const pending = getPendingOrder();
        if (!pending) return;

        try {
            const detail = await getOrderDetailForPending();
            if (!detail) return;
            setPendingOrder({
                ...pending,
                ...detail,
                id: detail?.id || detail?.order_id || pending.id,
                order_number: detail?.order_number || pending.ref,
                expires_at: detail?.expires_at || pending.expiresAt
            });
            startExpiryCountdown(detail?.expires_at || detail?.expiresAt || pending.expiresAt || null);

            const state = classifyOrderState(detail);
            const ref = detail?.order_number || detail?.order_id || pending.ref || pending.id;

            if (state === 'paid') {
                setPendingOrder(null);
                sessionStorage.removeItem('deliveryAddress');
                window.location.href = `order-success.html?order=${encodeURIComponent(ref)}`;
                return;
            }

            if (state === 'cancelled') {
                setPendingOrder(null);
                showWarning('Your order was cancelled. Items were not reserved. Please review your cart.');
                redirectToCartWithRestore('Order cancelled. Your cart has been restored.');
                return;
            }

            if (state === 'expired') {
                setPendingOrder(null);
                showWarning('Your order has expired. Please place your order again.');
                redirectToCartWithRestore('Order expired. Your cart has been restored.');
                return;
            }

            if (showUserMessage) {
                showWarning('Payment is pending. You can retry payment.');
            }
        } catch (error) {
            if (showUserMessage) {
                showError(apiMessage(error, 'Unable to refresh order status.'));
            }
        }
    }

    function startPendingStatusPolling() {
        if (pendingStatusPollId) window.clearInterval(pendingStatusPollId);
        if (!getPendingOrder()) return;

        pendingStatusPollId = window.setInterval(() => {
            refreshPendingOrderStatus(false);
        }, 12000);
    }

    function startExpiryCountdown(expiresAt) {
        const banner = getPaymentExpiryBanner();
        if (!expiresAt || !window.OrderFlowUtils?.createExpiryTimer) {
            banner.style.display = 'none';
            return;
        }

        if (paymentExpiryTimer) paymentExpiryTimer.stop();
        paymentExpiryTimer = window.OrderFlowUtils.createExpiryTimer({
            expiresAt,
            onTick(msLeft) {
                banner.style.display = 'block';
                banner.textContent = `Order expires in ${formatCountdown(msLeft)}. Complete payment now.`;
            },
            onExpire() {
                banner.style.display = 'none';
                setPendingOrder(null);
                showWarning('Order expired, please checkout again');
                redirectToCartWithRestore('Order expired. Your cart has been restored.');
            }
        });
        paymentExpiryTimer.start();
    }

    /**
     * Run backend stock check before payment progression.
     * @returns {Promise<boolean>}
     */
    async function ensureStockAvailableForPayment() {
        const stockPayload = await window.AMZIRA.stock.check();
        const normalized = window.OrderFlowUtils?.normalizeStockCheck
            ? window.OrderFlowUtils.normalizeStockCheck(stockPayload)
            : { available: Boolean(stockPayload?.available !== false), affectedItems: [] };

        if (normalized.available) return true;
        showError(normalized.affectedItems[0]?.message || 'Some items are out of stock. Your cart has been restored.');
        redirectToCartWithRestore('Stock changed. Your cart has been restored.');
        return false;
    }

    function renderAddress(address) {
        const name = esc(address.name || address.full_name || '');
        const phone = esc(address.mobile || address.phone || '');
        const address1 = esc(address.address || address.address_line1 || '');
        const locality = esc(address.locality || address.address_line2 || '');
        const city = esc(address.city || '');
        const state = esc(address.state || '');
        const pincode = esc(address.pincode || '');

        document.getElementById('deliveryAddress').innerHTML = `
            <strong>${name}</strong><br>
            ${address1}${locality ? `, ${locality}` : ''}, ${city}, ${state} - ${pincode}<br>
            <strong>Phone:</strong> ${phone}
        `;
    }

    function renderCartSummary(cartData) {
        const subtotal = Number(cartData?.subtotal || 0);
        const shipping = Number(cartData?.shipping_amount || (subtotal > 2000 ? 0 : 100));
        const discount = Number(cartData?.discount || 0);
        const tax = Number(cartData?.tax || subtotal * 0.18);
        const total = Number(cartData?.total || (subtotal - discount + shipping + tax));

        document.getElementById('subtotal').textContent = `‚Çπ${subtotal.toFixed(2)}`;
        document.getElementById('discount').textContent = discount > 0 ? `- ‚Çπ${discount.toFixed(2)}` : '‚Çπ0.00';
        document.getElementById('shipping').textContent = shipping === 0 ? 'FREE' : `‚Çπ${shipping.toFixed(2)}`;
        document.getElementById('tax').textContent = `‚Çπ${tax.toFixed(2)}`;
        document.getElementById('total').textContent = `‚Çπ${total.toFixed(2)}`;
    }

    function mapPaymentMethod(method) {
        return method === 'cod' ? 'cod' : 'razorpay';
    }

    function validatePaymentForm() {
        if (selectedPaymentMethod === 'card') {
            const cardNumber = document.getElementById('cardNumber')?.value;
            const cardName = document.getElementById('cardName')?.value;
            const cardExpiry = document.getElementById('cardExpiry')?.value;
            const cardCVV = document.getElementById('cardCVV')?.value;
            if (!cardNumber || !cardName || !cardExpiry || !cardCVV) {
                throw new Error('Please fill all card details');
            }
        } else if (selectedPaymentMethod === 'upi') {
            const upiId = document.getElementById('upiId')?.value;
            const selected = document.querySelector('.upi-option.selected');
            if (!upiId && !selected) {
                throw new Error('Please select UPI app or enter UPI ID');
            }
        } else if (selectedPaymentMethod === 'netbanking') {
            const bank = document.getElementById('bankSelect')?.value;
            if (!bank) {
                throw new Error('Please select your bank');
            }
        }
    }

    async function resolveBackendAddressId(address) {
        const numericId = Number(address?.id);
        if (Number.isInteger(numericId) && numericId > 0) return numericId;

        const phone = String(address.mobile || address.phone || '').trim();
        const pincode = String(address.pincode || '').trim();
        if (!Auth.validatePhone(phone)) {
            throw new Error('Please provide a valid 10-digit phone number in your delivery address.');
        }
        if (!/^\d{6}$/.test(pincode)) {
            throw new Error('Please provide a valid 6-digit pincode in your delivery address.');
        }

        const created = await window.AMZIRA.users.createAddress({
            full_name: address.name || address.full_name || 'Customer',
            phone,
            address_line1: address.address || address.address_line1 || '',
            address_line2: address.locality || address.address_line2 || null,
            city: address.city || '',
            state: address.state || '',
            pincode,
            country: 'India',
            address_type: address.addressType || address.address_type || 'home',
            is_default: Boolean(address.isDefault || address.is_default)
        });

        return created?.id;
    }

    function resetPayButton() {
        const payButton = document.getElementById('payButton');
        if (!payButton) return;
        if (Date.now() < rateLimitedUntil) return;
        payButton.disabled = false;
        payButton.innerHTML = '<i class="fas fa-lock"></i> Pay Securely';
    }

    async function openRazorpayForOrder(orderData) {
        const payButton = document.getElementById('payButton');
        const user = window.Auth?.getUser ? window.Auth.getUser() : null;
        const orderId = orderData?.order_id || orderData?.id;
        const orderRef = orderData?.order_number || orderId;
        if (!orderId) throw new Error('Order creation failed: missing order id');

        const paymentOrder = await window.AMZIRA.payments.createPaymentOrder(orderId);
        if (typeof window.Razorpay !== 'function') {
            throw new Error('Razorpay SDK is not loaded');
        }

        const options = {
            key: paymentOrder?.razorpay_key_id || paymentOrder?.key || paymentOrder?.key_id,
            amount: paymentOrder?.amount,
            currency: paymentOrder?.currency || 'INR',
            order_id: paymentOrder?.razorpay_order_id || paymentOrder?.order_id,
            name: 'Amzira',
            description: `Order ${orderRef || ''}`,
            prefill: {
                name: user?.name || '',
                email: user?.email || '',
                contact: user?.phone || ''
            },
            handler: async function(response) {
                try {
                    await window.AMZIRA.payments.verifyPayment(
                        response.razorpay_order_id,
                        response.razorpay_payment_id,
                        response.razorpay_signature
                    );
                    await refreshPendingOrderStatus(false);
                } catch (error) {
                    showError(apiMessage(error, 'Payment verification failed. Please retry.'));
                    resetPayButton();
                }
            },
            modal: {
                ondismiss: function() {
                    showWarning('Payment window closed. Your order is still pending payment.');
                    resetPayButton();
                }
            },
            theme: { color: '#8B1538' }
        };

        const razorpay = new window.Razorpay(options);
        razorpay.on('payment.failed', function() {
            showError('Payment failed. Your cart has been restored.');
            redirectToCartWithRestore('Payment failed. Your cart has been restored.');
        });
        razorpay.open();
    }

    async function processPayment() {
        if (Date.now() < rateLimitedUntil) return;

        const payButton = document.getElementById('payButton');
        payButton.disabled = true;
        payButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

        try {
            validatePaymentForm();
            await refreshPendingOrderStatus(false);

            const existingPending = getPendingOrder();
            if (existingPending?.id && selectedPaymentMethod !== 'cod') {
                if (!(await ensureStockAvailableForPayment())) return;
                await openRazorpayForOrder({ id: existingPending.id, order_number: existingPending.ref });
                return;
            }

            const address = checkoutContext.deliveryAddress;
            if (!address) throw new Error('No delivery address found. Please return to checkout.');

            const addressId = await resolveBackendAddressId(address);
            if (!addressId) throw new Error('Unable to resolve delivery address');

            const paymentMethod = mapPaymentMethod(selectedPaymentMethod);
            const createdOrder = await window.AMZIRA.orders.createOrder({
                shipping_address_id: addressId,
                billing_address_id: addressId,
                payment_method: paymentMethod
            });

            setPendingOrder(createdOrder);
            startExpiryCountdown(createdOrder?.expires_at || createdOrder?.expiresAt);

            if (paymentMethod === 'cod') {
                const ref = createdOrder?.order_number || createdOrder?.order_id || createdOrder?.id;
                setPendingOrder(null);
                sessionStorage.removeItem('deliveryAddress');
                window.location.href = `order-success.html?order=${encodeURIComponent(ref)}`;
                return;
            }

            if (!(await ensureStockAvailableForPayment())) return;
            showSuccess('Order created. Complete payment to confirm stock.');
            await openRazorpayForOrder(createdOrder);
        } catch (error) {
            if (error?.status === 429) {
                lockPayButton(RATE_LIMIT_LOCK_MS, 'Too many requests. Please slow down.');
                return;
            }

            if (error?.status === 409) {
                showWarning(apiMessage(error, 'Some items are no longer available in requested quantity.'));
                redirectToCartWithRestore('Stock changed. Your cart has been restored.');
                return;
            }

            showError(apiMessage(error, 'Payment failed'));
            resetPayButton();
        }
    }

    function initPaymentTabs() {
        const tabs = document.querySelectorAll('.payment-tab');
        const contents = document.querySelectorAll('.payment-content');
        tabs.forEach((tab) => {
            tab.addEventListener('click', function() {
                const method = this.getAttribute('data-method');
                selectedPaymentMethod = method;
                tabs.forEach((t) => t.classList.remove('active'));
                contents.forEach((c) => c.classList.remove('active'));
                this.classList.add('active');
                const panel = document.getElementById(method + 'Payment');
                if (panel) panel.classList.add('active');
            });
        });
    }

    function initCardFormatting() {
        const cardNumber = document.getElementById('cardNumber');
        const cardExpiry = document.getElementById('cardExpiry');
        const cardCVV = document.getElementById('cardCVV');

        if (cardNumber) {
            cardNumber.addEventListener('input', function() {
                let value = this.value.replace(/\D/g, '');
                value = value.replace(/(.{4})/g, '$1 ').trim();
                this.value = value.substring(0, 19);
            });
        }

        if (cardExpiry) {
            cardExpiry.addEventListener('input', function() {
                let value = this.value.replace(/\D/g, '');
                if (value.length >= 2) value = `${value.substring(0, 2)}/${value.substring(2, 4)}`;
                this.value = value;
            });
        }

        if (cardCVV) {
            cardCVV.addEventListener('input', function() {
                this.value = this.value.replace(/\D/g, '').substring(0, 3);
            });
        }
    }

    async function loadOrderSummary() {
        checkoutContext.deliveryAddress = JSON.parse(sessionStorage.getItem('deliveryAddress') || 'null');
        if (!checkoutContext.deliveryAddress) {
            showError('No delivery address found. Redirecting to checkout.');
            window.location.href = 'checkout.html';
            return;
        }

        renderAddress(checkoutContext.deliveryAddress);

        checkoutContext.cart = await window.AMZIRA.cart.getCart();
        const items = normalizeCartItems(checkoutContext.cart);
        if (!items.length) {
            window.location.href = 'cart.html';
            return;
        }

        renderCartSummary(checkoutContext.cart);
    }

    document.addEventListener('DOMContentLoaded', async function() {
        try {
            await loadOrderSummary();
            initPaymentTabs();
            initCardFormatting();
            document.getElementById('payButton').addEventListener('click', processPayment);
            document.querySelectorAll('.upi-option').forEach((option) => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.upi-option').forEach((opt) => opt.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });

            await refreshPendingOrderStatus(true);
            const pending = getPendingOrder();
            if (pending?.expiresAt) {
                startExpiryCountdown(pending.expiresAt);
            } else {
                const detail = await getOrderDetailForPending();
                startExpiryCountdown(detail?.expires_at || detail?.expiresAt || null);
            }
            startPendingStatusPolling();
        } catch (error) {
            showError(apiMessage(error, 'Unable to initialize payment'));
            window.location.href = 'checkout.html';
        }
    });

    window.addEventListener('beforeunload', function() {
        if (pendingStatusPollId) {
            window.clearInterval(pendingStatusPollId);
            pendingStatusPollId = null;
        }
        if (paymentExpiryTimer) {
            paymentExpiryTimer.stop();
            paymentExpiryTimer = null;
        }
    });
</script>

</body>
</html>
